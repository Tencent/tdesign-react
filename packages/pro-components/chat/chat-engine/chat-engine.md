---
title: ChatEngine å¯¹è¯å¼•æ“
description: æ™ºèƒ½ä½“å¯¹è¯åº•å±‚é€»è¾‘å¼•æ“ï¼Œæä¾›çµæ´»çš„ Hook API ç”¨äºæ·±åº¦å®šåˆ¶ã€‚
isComponent: true
spline: navigation
---

## é˜…è¯»æŒ‡å¼•

ChatEngine æ˜¯ä¸€ä¸ªåº•å±‚å¯¹è¯å¼•æ“ï¼Œæä¾›çµæ´»çš„ Hook API ç”¨äºæ·±åº¦å®šåˆ¶ã€‚æ”¯æŒè‡ªå®šä¹‰ UI ç»“æ„ã€æ¶ˆæ¯å¤„ç†å’Œ AG-UI åè®®ï¼Œé€‚åˆæ„å»ºå¤æ‚æ™ºèƒ½ä½“åº”ç”¨ï¼Œå¦‚å·¥å…·è°ƒç”¨ã€å¤šæ­¥éª¤ä»»åŠ¡è§„åˆ’ã€çŠ¶æ€æµå¼ä¼ è¾“ç­‰åœºæ™¯ï¼Œç›¸æ¯” Chatbot ç»„ä»¶æä¾›äº†æ›´é«˜çš„çµæ´»æ€§ï¼Œé€‚åˆéœ€è¦**æ·±åº¦å®šåˆ¶ UI ç»“æ„å’Œæ¶ˆæ¯å¤„ç†æµç¨‹**çš„åœºæ™¯ã€‚Chatbotç»„ä»¶æœ¬èº«ä¹Ÿæ˜¯åŸºäº ChatEngine æ„å»ºçš„ã€‚

å»ºè®®æŒ‰ä»¥ä¸‹è·¯å¾„å¾ªåºæ¸è¿›é˜…è¯»:

1. **å¿«é€Ÿå¼€å§‹** - äº†è§£ useChat Hook çš„åŸºæœ¬ç”¨æ³•ï¼Œç»„åˆç»„ä»¶æ„å»ºèŠå¤©ç•Œé¢çš„æ–¹æ³•
2. **åŸºç¡€ç”¨æ³•** - æŒæ¡æ•°æ®å¤„ç†ã€æ¶ˆæ¯ç®¡ç†ã€UI å®šåˆ¶ã€ç”Ÿå‘½å‘¨æœŸã€è‡ªå®šä¹‰æ¸²æŸ“ç­‰ä¸»è¦åŠŸèƒ½
3. **AG-UI åè®®** - å­¦ä¹  AG-UI åè®®çš„ä½¿ç”¨å’Œé«˜çº§ç‰¹æ€§ï¼ˆå·¥å…·è°ƒç”¨ã€çŠ¶æ€è®¢é˜…ç­‰ï¼‰

> ğŸ’¡ **ç¤ºä¾‹è¯´æ˜**ï¼šæ‰€æœ‰ç¤ºä¾‹éƒ½åŸºäº Mock SSE æœåŠ¡ï¼Œå¯ä»¥æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåˆ‡æ¢åˆ° Networkï¼ˆç½‘ç»œï¼‰æ ‡ç­¾ï¼ŒæŸ¥çœ‹æ¥å£çš„è¯·æ±‚å’Œå“åº”æ•°æ®ï¼Œäº†è§£æ•°æ®æ ¼å¼ã€‚


## å¿«é€Ÿå¼€å§‹

æœ€ç®€å•çš„ç¤ºä¾‹ï¼Œä½¿ç”¨ `useChat` Hook åˆ›å»ºå¯¹è¯å¼•æ“ï¼Œç»„åˆ `ChatList`ã€`ChatMessage`ã€`ChatSender` ç»„ä»¶æ„å»ºèŠå¤©ç•Œé¢ã€‚

{{ basic }}

## åŸºç¡€ç”¨æ³•

### åˆå§‹åŒ–æ¶ˆæ¯

ä½¿ç”¨ `defaultMessages` è®¾ç½®é™æ€åˆå§‹åŒ–æ¶ˆæ¯ï¼Œæˆ–é€šè¿‡ `chatEngine.setMessages` åŠ¨æ€åŠ è½½å†å²æ¶ˆæ¯ã€‚

{{ initial-messages }}

### æ•°æ®å¤„ç†

`chatServiceConfig` æ˜¯ ChatEngine çš„æ ¸å¿ƒé…ç½®ï¼Œæ§åˆ¶ç€ä¸åç«¯çš„é€šä¿¡å’Œæ•°æ®å¤„ç†ï¼Œæ˜¯è¿æ¥å‰ç«¯ç»„ä»¶å’Œåç«¯æœåŠ¡çš„æ¡¥æ¢ã€‚ä½œç”¨åŒ…æ‹¬
- **è¯·æ±‚é…ç½®** (endpointã€onRequestè®¾ç½®è¯·æ±‚å¤´ã€è¯·æ±‚å‚æ•°)
- **æ•°æ®è½¬æ¢** (onMessageï¼šå°†åç«¯æ•°æ®è½¬æ¢ä¸ºç»„ä»¶æ‰€éœ€æ ¼å¼)
- **ç”Ÿå‘½å‘¨æœŸå›è°ƒ** (onStartã€onCompleteã€onErrorã€onAbort)ã€‚

æ ¹æ®åç«¯æœåŠ¡åè®®çš„ä¸åŒï¼Œåˆæœ‰ä¸¤ç§é…ç½®æ–¹å¼ï¼š

- **è‡ªå®šä¹‰åè®®**ï¼šå½“åç«¯ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®æ ¼å¼æ—¶ï¼Œå¾€å¾€ä¸èƒ½æŒ‰ç…§å‰ç«¯ç»„ä»¶çš„è¦æ±‚æ¥è¾“å‡ºï¼Œè¿™æ—¶éœ€è¦é€šè¿‡ `onMessage` è¿›è¡Œæ•°æ®è½¬æ¢ã€‚
- **AG-UI åè®®**ï¼šå½“åç«¯æœåŠ¡ç¬¦åˆ [AG-UI åè®®](/react-chat/agui) æ—¶ï¼Œåªéœ€è®¾ç½® `protocol: 'agui'`ï¼Œæ— éœ€ç¼–å†™ `onMessage` è¿›è¡Œæ•°æ®è½¬æ¢ï¼Œå¤§å¤§ç®€åŒ–äº†æ¥å…¥æµç¨‹ã€‚è¯¦è§ä¸‹æ–¹ [AG-UI åè®®](#ag-ui-åè®®) ç« èŠ‚ã€‚

è¿™éƒ¨åˆ†çš„é…ç½®ç”¨æ³•ä¸Chatbotä¸­ä¸€è‡´ï¼Œç¤ºä¾‹å¯ä»¥å‚è€ƒ [Chatbot æ•°æ®å¤„ç†](/react-chat/components/chatbot#æ•°æ®å¤„ç†) ç« èŠ‚ã€‚

### å®ä¾‹æ–¹æ³•

é€šè¿‡ `chatEngine` è°ƒç”¨[å„ç§æ–¹æ³•](#chatengine-å®ä¾‹æ–¹æ³•)æ§åˆ¶ç»„ä»¶è¡Œä¸ºï¼ˆæ¶ˆæ¯è®¾ç½®ã€å‘é€ç®¡ç†ç­‰ï¼‰ã€‚

{{ instance-methods }}

### è‡ªå®šä¹‰æ¸²æŸ“

ä½¿ç”¨**åŠ¨æ€æ’æ§½æœºåˆ¶**å®ç°è‡ªå®šä¹‰æ¸²æŸ“ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰`å†…å®¹æ¸²æŸ“`ã€è‡ªå®šä¹‰`æ“ä½œæ `ã€è‡ªå®šä¹‰`è¾“å…¥åŒºåŸŸ`ã€‚


- **è‡ªå®šä¹‰å†…å®¹æ¸²æŸ“**ï¼šå¦‚æœéœ€è¦è‡ªå®šä¹‰æ¶ˆæ¯å†…å®¹çš„æ¸²æŸ“æ–¹å¼ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®ç°ï¼š
  - 1. æ‰©å±•ç±»å‹ï¼šé€šè¿‡ TypeScript å£°æ˜è‡ªå®šä¹‰å†…å®¹ç±»å‹
  - 2. è§£ææ•°æ®ï¼šåœ¨ `onMessage` ä¸­è¿”å›è‡ªå®šä¹‰ç±»å‹çš„æ•°æ®ç»“æ„
  - 3. ç›‘å¬å˜åŒ–ï¼šé€šè¿‡ `onMessageChange` ç›‘å¬æ¶ˆæ¯å˜åŒ–å¹¶åŒæ­¥åˆ°æœ¬åœ°çŠ¶æ€
  - 4. æ¤å…¥æ’æ§½ï¼šå¾ªç¯ `messages` æ•°ç»„ï¼Œä½¿ç”¨ `slot = ${content.type}-${index}` å±æ€§æ¥æ¸²æŸ“è‡ªå®šä¹‰ç»„ä»¶


- **è‡ªå®šä¹‰æ“ä½œæ **ï¼šå¦‚æœç»„ä»¶åº“å†…ç½®çš„ [`ChatActionbar`](/react-chat/components/chat-actionbar) ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡ `slot='actionbar'` å±æ€§æ¥æ¸²æŸ“è‡ªå®šä¹‰ç»„ä»¶ã€‚

- **è‡ªå®šä¹‰è¾“å…¥åŒºåŸŸ**ï¼šå¦‚æœéœ€è¦è‡ªå®šä¹‰ChatSenderè¾“å…¥åŒºï¼Œå¯ç”¨æ’æ§½è¯¦è§[ChatSenderæ’æ§½](/react-chat/components/chat-sender?tab=api#æ’æ§½) 


{{ custom-content }}

### ç»¼åˆç¤ºä¾‹

åœ¨äº†è§£äº†ä»¥ä¸Šå„ä¸ªåŸºç¡€å±æ€§çš„ç”¨æ³•åï¼Œè¿™é‡Œç»™å‡ºä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ç”Ÿäº§å®è·µä¸­ç»¼åˆä½¿ç”¨å¤šä¸ªåŠŸèƒ½ï¼šåˆå§‹æ¶ˆæ¯ã€æ¶ˆæ¯é…ç½®ã€æ•°æ®è½¬æ¢ã€è¯·æ±‚é…ç½®ã€å®ä¾‹æ–¹æ³•å’Œè‡ªå®šä¹‰æ’æ§½ã€‚

{{ comprehensive }}


## AG-UI åè®®

[AG-UIï¼ˆAgent-User Interface)](https://docs.ag-ui.com/introduction) æ˜¯ä¸€ä¸ªä¸“ä¸º AI Agent ä¸å‰ç«¯åº”ç”¨äº¤äº’è®¾è®¡çš„è½»é‡çº§åè®®ï¼Œä¸“æ³¨äºå®æ—¶äº¤äº’ã€çŠ¶æ€æµå¼ä¼ è¾“å’Œäººæœºåä½œã€‚ChatEngine å†…ç½®äº†å¯¹ AG-UI åè®®çš„æ”¯æŒï¼Œå¯ä»¥**æ— ç¼é›†æˆç¬¦åˆ AG-UI æ ‡å‡†çš„åç«¯æœåŠ¡**ã€‚

### åŸºç¡€ç”¨æ³•

å¼€å¯ AG-UI åè®®æ”¯æŒï¼ˆ`protocol: 'agui'`ï¼‰ï¼Œç»„ä»¶ä¼šè‡ªåŠ¨è§£ææ ‡å‡†äº‹ä»¶ç±»å‹ï¼ˆå¦‚ `TEXT_MESSAGE_*`ã€`THINKING_*`ã€`TOOL_CALL_*`ã€`STATE_*` ç­‰ï¼‰ã€‚ä½¿ç”¨`AGUIAdapter.convertHistoryMessages`æ–¹æ³•å³å¯å®ç°ç¬¦åˆ[`AGUIHistoryMessage`](https://github.com/TDesignOteam/tdesign-web-components/blob/develop/src/chat-engine/adapters/agui/types.ts)æ•°æ®ç»“æ„çš„å†å²æ¶ˆæ¯å›å¡«ã€‚

{{ agui-basic }}


### å·¥å…·è°ƒç”¨

AG-UI åè®®æ”¯æŒé€šè¿‡ `TOOL_CALL_*` äº‹ä»¶è®© AI Agent è°ƒç”¨å‰ç«¯å·¥å…·ç»„ä»¶ï¼Œå®ç°äººæœºåä½œã€‚

> **åè®®å…¼å®¹æ€§è¯´æ˜**ï¼š`useAgentToolcall` å’Œ `ToolCallRenderer` æœ¬èº«æ˜¯åè®®æ— å…³çš„ï¼Œå®ƒä»¬åªä¾èµ– [ToolCall æ•°æ®ç»“æ„](#toolcall-å¯¹è±¡ç»“æ„)ï¼Œä¸å…³å¿ƒæ•°æ®æ¥æºã€‚AG-UI åè®®çš„ä¼˜åŠ¿åœ¨äºè‡ªåŠ¨åŒ–ï¼ˆåç«¯ç›´æ¥è¾“å‡ºæ ‡å‡† `TOOL_CALL_*` äº‹ä»¶ï¼‰ï¼Œæ™®é€šåè®®éœ€è¦åœ¨ `onMessage` ä¸­æ‰‹åŠ¨å°†åç«¯æ•°æ®è½¬æ¢ä¸º `ToolCall` ç»“æ„ã€‚é€šè¿‡é€‚é…å™¨å¯ä»¥é™ä½æ‰‹åŠ¨è½¬æ¢çš„å¤æ‚åº¦ã€‚

#### æ ¸å¿ƒ Hook ä¸ç»„ä»¶

ChatEngine å›´ç»•å·¥å…·è°ƒç”¨æä¾›äº†å‡ ä¸ªæ ¸å¿ƒ Hookï¼Œå®ƒä»¬å„å¸å…¶èŒï¼ŒååŒå·¥ä½œï¼š

- **`useAgentToolcall` Hook**ï¼šæ³¨å†Œå·¥å…·é…ç½®ï¼ˆå…ƒæ•°æ®ã€å‚æ•°ã€UI ç»„ä»¶ï¼‰ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„è‡ªå®šä¹‰æ¸²æŸ“æ–¹å¼ï¼Œæä¾›äº†é«˜åº¦å†…èšçš„é…ç½®ã€ç»Ÿä¸€çš„ API æ¥å£ã€å®Œæ•´çš„ç±»å‹å®‰å…¨å’Œæ›´å¥½çš„å¯ç§»æ¤æ€§ã€‚è¯¦è§ä¸‹æ–¹[å¸¸è§é—®é¢˜](/react-chat/components/chat-engine?tab=demo#å¸¸è§é—®é¢˜)
- **`ToolCallRenderer` ç»„ä»¶**ï¼šå·¥å…·è°ƒç”¨çš„ç»Ÿä¸€æ¸²æŸ“å™¨ï¼Œè´Ÿè´£æ ¹æ®å·¥å…·åç§°æŸ¥æ‰¾å¯¹åº”çš„é…ç½®ï¼Œè§£æå‚æ•°ï¼Œç®¡ç†çŠ¶æ€å¹¶æ¸²æŸ“æ³¨å†Œçš„ UI ç»„ä»¶ã€‚ä½¿ç”¨æ—¶åªéœ€ä¼ å…¥ `toolCall` å¯¹è±¡å³å¯è‡ªåŠ¨å®Œæˆæ¸²æŸ“
- **`useAgentState` Hook**ï¼šè®¢é˜… AG-UI åè®®çš„ `STATE_SNAPSHOT` å’Œ `STATE_DELTA` äº‹ä»¶ï¼Œå®æ—¶è·å–ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€‚

#### ä½¿ç”¨æµç¨‹

1. ä½¿ç”¨ `useAgentToolcall` æ³¨å†Œå·¥å…·é…ç½®ï¼ˆå…ƒæ•°æ®ã€å‚æ•°ã€UI ç»„ä»¶ï¼‰
2. åœ¨æ¶ˆæ¯æ¸²æŸ“æ—¶ä½¿ç”¨ `ToolCallRenderer` ç»„ä»¶æ¸²æŸ“å·¥å…·è°ƒç”¨
3. `ToolCallRenderer` è‡ªåŠ¨æŸ¥æ‰¾é…ç½®ã€è§£æå‚æ•°ã€ç®¡ç†çŠ¶æ€ã€æ¸²æŸ“ UI


#### åŸºç¡€ç¤ºä¾‹

ä¸€ä¸ªæ¨¡æ‹Ÿå›¾ç‰‡ç”ŸæˆåŠ©æ‰‹çš„Agentï¼Œå±•ç¤ºå·¥å…·è°ƒç”¨å’ŒçŠ¶æ€è®¢é˜…çš„æ ¸å¿ƒç”¨æ³•ï¼š

- **å·¥å…·æ³¨å†Œ**ï¼šä½¿ç”¨ `useAgentToolcall` æ³¨å†Œ `generate_image` å·¥å…·
- **çŠ¶æ€è®¢é˜…**ï¼šä½¿ç”¨æ³¨å…¥çš„ `agentState` å‚æ•°æ¥è®¢é˜…å›¾ç‰‡ç”Ÿæˆè¿›åº¦ï¼ˆpreparing â†’ generating â†’ completed/failedï¼‰
- **è¿›åº¦å±•ç¤º**ï¼šå®æ—¶æ˜¾ç¤ºç”Ÿæˆè¿›åº¦æ¡å’ŒçŠ¶æ€ä¿¡æ¯
- **ç»“æœå‘ˆç°**ï¼šç”Ÿæˆå®Œæˆåå±•ç¤ºå›¾ç‰‡
- **æ¨èé—®é¢˜**ï¼šé€šè¿‡è¿”å›`toolcallName: 'suggestion'`ï¼Œå¯ä»¥æ— ç¼å¯¹æ¥å†…ç½®çš„æ¨èé—®é¢˜ç»„ä»¶

{{ agui-toolcall }}


### å·¥å…·çŠ¶æ€è®¢é˜…

åœ¨ AG-UI åè®®ä¸­ï¼Œé™¤äº†å·¥å…·ç»„ä»¶å†…éƒ¨éœ€è¦å±•ç¤ºçŠ¶æ€ï¼Œæœ‰æ—¶æˆ‘ä»¬è¿˜éœ€è¦åœ¨**å¯¹è¯ç»„ä»¶å¤–éƒ¨çš„ UI**ï¼ˆå¦‚é¡µé¢é¡¶éƒ¨çš„è¿›åº¦æ¡ã€ä¾§è¾¹æ çš„ä»»åŠ¡åˆ—è¡¨ç­‰ï¼‰ä¸­è®¢é˜…å’Œå±•ç¤ºå·¥å…·æ‰§è¡ŒçŠ¶æ€ã€‚AgentæœåŠ¡æ˜¯é€šåœ¨å·¥å…·è°ƒç”¨è¿‡ç¨‹ä¸­å¢åŠ `STATE_SNAPSHOT` å’Œ `STATE_DELTA` äº‹ä»¶æ¥å®ç°çŠ¶æ€å˜æ›´ã€å¿«ç…§çš„æµå¼ä¼ è¾“ã€‚

ä¸ºäº†æ–¹ä¾¿æ—è·¯UIç»„ä»¶è®¢é˜…çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ `useAgentState` æ¥è·å–çŠ¶æ€æ•°æ®ï¼Œå®æ—¶æ¸²æŸ“ä»»åŠ¡æ‰§è¡Œè¿›åº¦å’ŒçŠ¶æ€ä¿¡æ¯ã€‚æ¯”å¦‚è¦åœ¨é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºå½“å‰ä»»åŠ¡çš„æ‰§è¡Œè¿›åº¦ï¼Œä¸åœ¨å¯¹è¯æµä¸­å±•ç¤ºï¼Œ å¯ä»¥è¿™æ ·å®ç°ã€‚

```javascript
// å¤–éƒ¨è¿›åº¦é¢æ¿ç»„ä»¶
const GlobalProgressBar: React.FC = () => {
  // ä½¿ç”¨ useAgentState è®¢é˜…çŠ¶æ€
  const { stateMap, currentStateKey } = useAgentState();
  
  /* åç«¯é€šè¿‡ STATE_SNAPSHOT å’Œ STATE_DELTA äº‹ä»¶æ¨é€çŠ¶æ€æ•°æ®ï¼Œæ¨¡æ‹Ÿæ•°æ®å¦‚ä¸‹ï¼š
  // 
  // STATE_SNAPSHOTï¼ˆåˆå§‹å¿«ç…§ï¼‰ï¼š
  // data: {"type":"STATE_SNAPSHOT","snapshot":{"task_xxx":{"progress":0,"message":"å‡†å¤‡å¼€å§‹è§„åˆ’...","items":[]}}}
  //
  // STATE_DELTAï¼ˆå¢é‡æ›´æ–°ï¼Œä½¿ç”¨ JSON Patch æ ¼å¼ï¼‰ï¼š
  // data: {"type":"STATE_DELTA","delta":[
  //   {"op":"replace","path":"/task_xxx/progress","value":20},
  //   {"op":"replace","path":"/task_xxx/message","value":"åˆ†æç›®çš„åœ°ä¿¡æ¯"},
  //   {"op":"replace","path":"/task_xxx/items","value":[{"label":"åˆ†æç›®çš„åœ°ä¿¡æ¯","status":"running"}]}
  // ]}
  */ 
 
  // useAgentState å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç†è¿™äº›äº‹ä»¶ï¼Œå°† snapshot å’Œ delta åˆå¹¶åˆ° stateMap ä¸­
  
  // è·å–å½“å‰ä»»åŠ¡çŠ¶æ€
  const currentState = currentStateKey ? stateMap[currentStateKey] : null;
  
  // items æ•°ç»„åŒ…å«ä»»åŠ¡çš„å„ä¸ªæ­¥éª¤ä¿¡æ¯
  // æ¯ä¸ª item åŒ…å«ï¼šlabelï¼ˆæ­¥éª¤åç§°ï¼‰ã€statusï¼ˆçŠ¶æ€ï¼šrunning/completed/failedï¼‰
  const items = currentState?.items || [];
  const completedCount = items.filter((item: any) => item.status === 'completed').length;
  
  return (
    <div>
      <div>è¿›åº¦ï¼š{completedCount}/{items.length}</div>
      {items.map((item: any, index: number) => (
        <div key={index}>
          {item.label} - {item.status}
        </div>
      ))}
    </div>
  );
};
```

å½“å¤šä¸ªå¤–éƒ¨ç»„ä»¶éœ€è¦è®¿é—®åŒä¸€ä»½çŠ¶æ€æ—¶ï¼Œä½¿ç”¨ Provider æ¨¡å¼ã€‚é€šè¿‡ä½¿ç”¨ `AgentStateProvider` + `useAgentStateContext` æ¥å…±äº«çŠ¶æ€

å®Œæ•´ç¤ºä¾‹è¯·å‚è€ƒä¸‹æ–¹ [ç»¼åˆç¤ºä¾‹](#ç»¼åˆç¤ºä¾‹) æ¼”ç¤ºã€‚

### ç»¼åˆç¤ºä¾‹

æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„**æ—…æ¸¸è§„åˆ’ Agent åœºæ™¯**ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ AG-UI åè®®æ„å»ºå¤æ‚çš„**å¤šæ­¥éª¤ä»»åŠ¡è§„åˆ’**åº”ç”¨ã€‚å…ˆæ”¶é›†ç”¨æˆ·åå¥½ï¼ˆHuman-in-the-Loopï¼‰ï¼Œç„¶åæ ¹æ®ç”¨æˆ·æäº¤çš„åå¥½ä¾æ¬¡æ‰§è¡Œï¼šæŸ¥è¯¢å¤©æ°”ã€å±•ç¤ºè§„åˆ’æ­¥éª¤çš„å·¥å…·è°ƒç”¨ï¼Œæœ€åæ€»ç»“ç”Ÿæˆæœ€ç»ˆè®¡åˆ’

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- **16 ç§æ ‡å‡†åŒ–äº‹ä»¶ç±»å‹**ï¼šå®Œæ•´å±•ç¤º AG-UI åè®®çš„äº‹ä»¶ä½“ç³»
- **å¤šæ­¥éª¤æµç¨‹**ï¼šæ”¯æŒåˆ†æ­¥éª¤æ‰§è¡Œå¤æ‚ä»»åŠ¡ï¼ˆå¦‚æ—…æ¸¸è§„åˆ’ï¼‰
- **çŠ¶æ€æµå¼ä¼ è¾“**ï¼šå®æ—¶æ›´æ–°åº”ç”¨çŠ¶æ€ï¼Œæ”¯æŒçŠ¶æ€å¿«ç…§å’Œå¢é‡æ›´æ–°
- **Human-in-the-Loop**ï¼šæ”¯æŒäººæœºåä½œï¼Œåœ¨æµç¨‹ä¸­æ’å…¥ç”¨æˆ·è¾“å…¥ç¯èŠ‚
- **å·¥å…·è°ƒç”¨**ï¼šé›†æˆå¤–éƒ¨å·¥å…·è°ƒç”¨ï¼Œå¦‚å¤©æ°”æŸ¥è¯¢ã€è¡Œç¨‹è§„åˆ’ç­‰
- **å¤–éƒ¨çŠ¶æ€è®¢é˜…**ï¼šæ¼”ç¤ºå¦‚ä½•åœ¨å¯¹è¯ç»„ä»¶å¤–éƒ¨è®¢é˜…å’Œå±•ç¤ºå·¥å…·æ‰§è¡ŒçŠ¶æ€

**ç¤ºä¾‹è¦ç‚¹ï¼š**

1. **ä¸‰ç§å…¸å‹å·¥å…·è°ƒç”¨æ¨¡å¼**
   - å¤©æ°”æŸ¥è¯¢ï¼šå±•ç¤ºåŸºç¡€çš„ `TOOL_CALL_*` äº‹ä»¶å¤„ç†
   - è§„åˆ’æ­¥éª¤ï¼šå±•ç¤º `STATE_*` äº‹ä»¶è®¢é˜… + `agentState` è‡ªåŠ¨æ³¨å…¥
   - ç”¨æˆ·åå¥½ï¼šå±•ç¤º Human-in-the-Loop äº¤äº’å¼å·¥å…·

2. **å·¥å…·ç»„ä»¶å†…çŠ¶æ€ä½¿ç”¨**
   - å·¥å…·ç»„ä»¶é€šè¿‡ `agentState` å‚æ•°è‡ªåŠ¨è·å–çŠ¶æ€ï¼Œæ— éœ€é¢å¤– Hook
   - é…ç½® `subscribeKey` å‘Šè¯‰ Renderer è®¢é˜…å“ªä¸ªçŠ¶æ€ key

3. **å¤–éƒ¨ UI çŠ¶æ€è®¢é˜…**
   - ä½¿ç”¨ `useAgentState` åœ¨å¯¹è¯ç»„ä»¶å¤–éƒ¨è®¢é˜…çŠ¶æ€
   - å®æ—¶å±•ç¤ºä»»åŠ¡æ‰§è¡Œè¿›åº¦å’ŒçŠ¶æ€ä¿¡æ¯

{{ agui-comprehensive }}


## API

### useChat

ç”¨äºç®¡ç†èŠå¤©çŠ¶æ€ä¸ç”Ÿå‘½å‘¨æœŸçš„æ ¸å¿ƒ Hookï¼Œåˆå§‹åŒ–èŠå¤©å¼•æ“ã€åŒæ­¥æ¶ˆæ¯æ•°æ®ã€è®¢é˜…çŠ¶æ€å˜æ›´ï¼Œå¹¶è‡ªåŠ¨å¤„ç†ç»„ä»¶å¸è½½æ—¶çš„èµ„æºæ¸…ç†ã€‚

#### å‚æ•°

| å‚æ•°å            | ç±»å‹               | è¯´æ˜                                                                                     | å¿…ä¼  |
| ----------------- | ------------------ | ---------------------------------------------------------------------------------------- | ---- |
| defaultMessages   | ChatMessagesData[] | åˆå§‹åŒ–æ¶ˆæ¯åˆ—è¡¨                                                                           | N    |
| chatServiceConfig | ChatServiceConfig  | èŠå¤©æœåŠ¡é…ç½®ï¼Œè¯¦è§ [Chatbot æ–‡æ¡£](/react-chat/components/chatbot?tab=api#chatserviceconfig-é…ç½®è¯´æ˜) | Y    |

#### è¿”å›å€¼

| è¿”å›å€¼     | ç±»å‹               | è¯´æ˜                                                                 |
| ---------- | ------------------ | -------------------------------------------------------------------- |
| chatEngine | ChatEngine         | èŠå¤©å¼•æ“å®ä¾‹ï¼Œè¯¦è§ä¸‹æ–¹ [ChatEngine å®ä¾‹æ–¹æ³•](#chatengine-å®ä¾‹æ–¹æ³•) |
| messages   | ChatMessagesData[] | å½“å‰èŠå¤©æ¶ˆæ¯åˆ—è¡¨                                                     |
| status     | ChatStatus         | å½“å‰èŠå¤©çŠ¶æ€ï¼ˆidle/pending/streaming/complete/stop/errorï¼‰          |

### ChatEngine å®ä¾‹æ–¹æ³•

ChatEngine å®ä¾‹æ–¹æ³•ä¸ Chatbot ç»„ä»¶å®ä¾‹æ–¹æ³•å®Œå…¨ä¸€è‡´ï¼Œè¯¦è§ [Chatbot å®ä¾‹æ–¹æ³•æ–‡æ¡£](/react-chat/components/chatbot?tab=api#chatbot-å®ä¾‹æ–¹æ³•å’Œå±æ€§)ã€‚

### useAgentToolcall

ç”¨äºæ³¨å†Œå·¥å…·è°ƒç”¨é…ç½®çš„ Hookï¼Œæ”¯æŒè‡ªåŠ¨æ³¨å†Œå’Œæ‰‹åŠ¨æ³¨å†Œä¸¤ç§æ¨¡å¼ã€‚

#### å‚æ•°

| å‚æ•°å | ç±»å‹                                                              | è¯´æ˜                                                     | å¿…ä¼  |
| ------ | ----------------------------------------------------------------- | -------------------------------------------------------- | ---- |
| config | AgentToolcallConfig \\| AgentToolcallConfig[] \\| null \\| undefined | å·¥å…·è°ƒç”¨é…ç½®å¯¹è±¡æˆ–æ•°ç»„ï¼Œä¼ å…¥æ—¶è‡ªåŠ¨æ³¨å†Œï¼Œä¸ä¼ å…¥æ—¶æ‰‹åŠ¨æ³¨å†Œ | N    |

#### è¿”å›å€¼

| è¿”å›å€¼        | ç±»å‹                                                           | è¯´æ˜                     |
| ------------- | -------------------------------------------------------------- | ------------------------ |
| register      | (config: AgentToolcallConfig \\| AgentToolcallConfig[]) => void | æ‰‹åŠ¨æ³¨å†Œå·¥å…·é…ç½®         |
| unregister    | (names: string \\| string[]) => void                            | å–æ¶ˆæ³¨å†Œå·¥å…·é…ç½®         |
| isRegistered  | (name: string) => boolean                                      | æ£€æŸ¥å·¥å…·æ˜¯å¦å·²æ³¨å†Œ       |
| getRegistered | () => string[]                                                 | è·å–æ‰€æœ‰å·²æ³¨å†Œçš„å·¥å…·åç§° |

#### AgentToolcallConfig é…ç½®

| å±æ€§å       | ç±»å‹                                        | è¯´æ˜                                       | å¿…ä¼  |
| ------------ | ------------------------------------------- | ------------------------------------------ | ---- |
| name         | string                                      | å·¥å…·è°ƒç”¨åç§°ï¼Œéœ€è¦ä¸åç«¯å®šä¹‰çš„å·¥å…·åç§°ä¸€è‡´ | Y    |
| description  | string                                      | å·¥å…·è°ƒç”¨æè¿°                               | Y    |
| parameters   | ParameterDefinition[]                       | å‚æ•°å®šä¹‰æ•°ç»„                               | Y    |
| component    | React.ComponentType<ToolcallComponentProps> | è‡ªå®šä¹‰æ¸²æŸ“ç»„ä»¶                             | Y    |
| handler      | (args, result?) => Promise<any>             | éäº¤äº’å¼å·¥å…·çš„å¤„ç†å‡½æ•°ï¼ˆå¯é€‰ï¼‰             | N    |
| subscribeKey | (props) => string \\| undefined              | çŠ¶æ€è®¢é˜… key æå–å‡½æ•°ï¼ˆå¯é€‰ï¼‰              | N    |

#### ToolcallComponentProps ç»„ä»¶å±æ€§

| å±æ€§å     | ç±»å‹                                                 | è¯´æ˜                                |
| ---------- | ---------------------------------------------------- | ----------------------------------- |
| status     | 'idle' \\| 'inProgress' \\| 'executing' \\| 'complete' \\| 'error' | å·¥å…·è°ƒç”¨çŠ¶æ€                        |
| args       | TArgs                                                | è§£æåçš„å·¥å…·è°ƒç”¨å‚æ•°                |
| result     | TResult                                              | å·¥å…·è°ƒç”¨ç»“æœ                        |
| error      | Error                                                | é”™è¯¯ä¿¡æ¯ï¼ˆå½“ status ä¸º 'error' æ—¶ï¼‰ |
| respond    | (response: TResponse) => void                        | å“åº”å›è°ƒå‡½æ•°ï¼ˆç”¨äºäº¤äº’å¼å·¥å…·ï¼‰      |
| agentState | Record<string, any>                                  | è®¢é˜…çš„çŠ¶æ€æ•°æ®ï¼ˆé…ç½® subscribeKey åè‡ªåŠ¨æ³¨å…¥ï¼‰ |

### ToolCallRenderer

å·¥å…·è°ƒç”¨çš„ç»Ÿä¸€æ¸²æŸ“ç»„ä»¶ï¼Œè´Ÿè´£æ ¹æ®å·¥å…·åç§°è‡ªåŠ¨æŸ¥æ‰¾é…ç½®ã€è§£æå‚æ•°ã€ç®¡ç†çŠ¶æ€å¹¶æ¸²æŸ“å¯¹åº”çš„ UI ç»„ä»¶ã€‚

#### Props

| å±æ€§å    | ç±»å‹                                        | è¯´æ˜                                           | å¿…ä¼  |
| --------- | ------------------------------------------- | ---------------------------------------------- | ---- |
| toolCall  | ToolCall [å¯¹è±¡ç»“æ„](https://github.com/TDesignOteam/tdesign-web-components/blob/develop/src/chat-engine/type.ts#L97)                                    | å·¥å…·è°ƒç”¨å¯¹è±¡ï¼ŒåŒ…å« toolCallNameã€argsã€result ç­‰ä¿¡æ¯ | Y    |
| onRespond | (toolCall: ToolCall, response: any) => void | äº¤äº’å¼å·¥å…·çš„å“åº”å›è°ƒï¼Œç”¨äºå°†ç”¨æˆ·è¾“å…¥è¿”å›ç»™åç«¯ | N    |


### useAgentState

ç”¨äºè®¢é˜… AG-UI åè®®çŠ¶æ€äº‹ä»¶çš„ Hookï¼Œæä¾›çµæ´»çš„çŠ¶æ€è®¢é˜…æœºåˆ¶ã€‚

> ğŸ’¡ **ä½¿ç”¨å»ºè®®**ï¼šè¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œåœºæ™¯ç¤ºä¾‹è¯·å‚è€ƒä¸Šæ–¹ [å·¥å…·çŠ¶æ€è®¢é˜…](#å·¥å…·çŠ¶æ€è®¢é˜…) ç« èŠ‚ã€‚

#### å‚æ•°

| å‚æ•°å  | ç±»å‹               | è¯´æ˜             | å¿…ä¼  |
| ------- | ------------------ | ---------------- | ---- |
| options | StateActionOptions | çŠ¶æ€è®¢é˜…é…ç½®é€‰é¡¹ | N    |

#### StateActionOptions é…ç½®

| å±æ€§å       | ç±»å‹                | è¯´æ˜                                                                 | å¿…ä¼  |
| ------------ | ------------------- | -------------------------------------------------------------------- | ---- |
| subscribeKey | string              | æŒ‡å®šè¦è®¢é˜…çš„ stateKeyï¼Œä¸ä¼ å…¥æ—¶è®¢é˜…æœ€æ–°çŠ¶æ€                          | N    |
| initialState | Record<string, any> | åˆå§‹çŠ¶æ€å€¼                                                           | N    |

#### è¿”å›å€¼

| è¿”å›å€¼          | ç±»å‹                                                | è¯´æ˜                                     |
| --------------- | --------------------------------------------------- | ---------------------------------------- |
| stateMap        | Record<string, any>                                 | çŠ¶æ€æ˜ å°„è¡¨ï¼Œæ ¼å¼ä¸º { [stateKey]: stateData } |
| currentStateKey | string \\| null                                      | å½“å‰æ´»è·ƒçš„ stateKey                      |
| setStateMap     | (stateMap: Record<string, any> \\| Function) => void | æ‰‹åŠ¨è®¾ç½®çŠ¶æ€æ˜ å°„è¡¨çš„æ–¹æ³•                 |
| getCurrentState | () => Record<string, any>                           | è·å–å½“å‰å®Œæ•´çŠ¶æ€çš„æ–¹æ³•                   |
| getStateByKey   | (key: string) => any                                | è·å–ç‰¹å®š key çŠ¶æ€çš„æ–¹æ³•                  |
